var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,c){a instanceof String&&(a=String(a));for(var b=a.length,e=0;e<b;e++){var f=a[e];if(d.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,c,b){if(d){c=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in c||(c[e]={});c=c[e]}a=a[a.length-1];b=c[a];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
jQuery(function(a){a("form.checkout, form#order_review").on("change",'input[name="wc-paycore-payment-token"]',function(){"new"===a('.paycore-legacy-payment-fields input[name="wc-paycore-payment-token"]:checked').val()?a(".paycore-legacy-payment-fields #paycore-payment-data").slideDown(200):a(".paycore-legacy-payment-fields #paycore-payment-data").slideUp(200)});var d={init:function(){a("form.woocommerce-checkout").length&&(this.form=a("form.woocommerce-checkout"));a("form.woocommerce-checkout").on("checkout_place_order_paycore",
this.onSubmit);if(wc_paycore_params.legacy)a("form.woocommerce-checkout").on("submit",this.onSubmit);a("form#order_review").length&&(this.form=a("form#order_review"));a("form#order_review").on("submit",this.onSubmit);a("form#add_payment_method").length&&(this.form=a("form#add_payment_method"));a("form#add_payment_method").on("submit",this.onSubmit);a(document).on("change","#wc-paycore-cc-form :input",this.onCCFormChange).on("paycoreError",this.onError).on("checkout_error",this.clearToken)},isPaycoreChosen:function(){return a("#payment_method_paycore").is(":checked")&&
(!a('input[name="wc-paycore-payment-token"]:checked').length||"new"===a('input[name="wc-paycore-payment-token"]:checked').val())},hasToken:function(){return 0<a("input.paycore_token").length},block:function(){d.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){d.form.unblock()},onError:function(c,b){c=b.response.error.message;if("invalid_request_error"===b.response.error.type||"api_connection_error"===b.response.error.type||"api_error"===b.response.error.type||
"authentication_error"===b.response.error.type||"rate_limit_error"===b.response.error.type)c=wc_paycore_params.invalid_request_error;"card_error"===b.response.error.type&&wc_paycore_params.hasOwnProperty(b.response.error.code)&&(c=wc_paycore_params[b.response.error.code]);a(".wc-paycore-error, .paycore_token").remove();a("#paycore-card-number").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-paycore-error"><li>'+c+"</li></ul>");d.unblock()},onSubmit:function(c){if(d.isPaycoreChosen()&&
!d.hasToken()){c.preventDefault();d.block();c=d.form.serialize();var b=a('input[name="paycore_payment_method"]:checked').attr("value");b&&(c+="&paycore-payment-method="+b);a.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:c,dataType:"json",success:function(b){try{if("success"===b.result){var c=a("<form></form>");c.attr("method","post");c.attr("action","http://checkout.dev.paycore.io");c.attr("id","redirect_form");c.append('<input type="hidden" name="signature" value="'+b.signature+'">');
c.append('<input type="hidden" name="data" value="'+b.data+'">');a("body").append(c);c.submit()}else{if("failure"===b.result)throw"Result failure";throw"Invalid response";}}catch(g){!0===b.reload?window.location.reload():(!0===b.refresh&&a(document.body).trigger("update_checkout"),b.messages?d.submit_error(b.messages):d.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>"))}},error:function(a,b,c){d.submit_error('<div class="woocommerce-error">'+c+"</div>")}});
return!1}},onCCFormChange:function(){a(".wc-paycore-error, .paycore_token").remove()},submit_error:function(c){a(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove();d.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+c+"</div>");d.form.removeClass("processing").unblock();d.form.find(".input-text, select, input:checkbox").trigger("validate").blur();a("html, body").animate({scrollTop:a("form.checkout").offset().top-100},1E3);a(document.body).trigger("checkout_error")},
onPaycoreResponse:function(c,b){if(b.error)a(document).trigger("paycoreError",{response:b});else{if("no"===wc_paycore_params.allow_prepaid_card&&"prepaid"===b.card.funding)return b.error={message:wc_paycore_params.no_prepaid_card_msg},a(document).trigger("paycoreError",{response:b}),!1;d.form.append("<input type='hidden' class='paycore_token' name='paycore_token' value='"+b.id+"'/>");d.form.submit()}},clearToken:function(){a(".paycore_token").remove()}};d.init()});
